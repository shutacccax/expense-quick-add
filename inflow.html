<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Quick Add Inflow</title>

  <link rel="manifest" href="manifest.json" />
  <link rel="stylesheet" href="styles.css">
  <link rel="apple-touch-icon" href="icon-180.png">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="default">

</head>
<body>

  <div class="container">
    <div class="card">

      <h1>âž• Add Inflow</h1>

      <a href="balances.html" class="balances-link">
        View balances
      </a>

      <button id="themeToggle" type="button" aria-label="Toggle dark mode">
        ðŸŒ™
      </button>


      <label for="date">Date</label>
      <input type="date" id="date" />

      <label for="description">Description</label>
      <input type="text" id="description" placeholder="Optional" />


      <label for="account">Account</label>
        <select id="account">
            <option>Cash</option>
            <option>GCash</option>
            <option>MariBank</option>
            <option>Maya</option>
        </select>


      <label for="amount">Amount</label>
      <input type="number" id="amount" placeholder="0.00" inputmode="decimal" />

      <button id="addInflowBtn" type="button">
        Add Inflow
      </button>


    </div>
  </div>



  <script>
    
  const today = new Date();
  today.setMinutes(today.getMinutes() - today.getTimezoneOffset());
  document.getElementById("date").value = today.toISOString().slice(0, 10);

  document.getElementById("amount").addEventListener("keydown", e => {
    if (e.key === "Enter") addButton.click();
  });


  const body = document.body;
  const themeToggle = document.getElementById("themeToggle");

  // Load saved theme
  if (localStorage.getItem("theme") === "dark") {
    body.classList.add("dark");
    themeToggle.textContent = "â˜€ï¸";
  } else {
    themeToggle.textContent = "ðŸŒ™";
  }

  themeToggle.addEventListener("click", () => {
    body.classList.toggle("dark");
    const isDark = body.classList.contains("dark");

    localStorage.setItem("theme", isDark ? "dark" : "light");
    themeToggle.textContent = isDark ? "â˜€ï¸" : "ðŸŒ™";
  });

  
  const scriptURL = "https://script.google.com/macros/s/AKfycbx0j7hBNOI9P_zceaZeLrkypGOXP5s7Emk0GqOfUiNns1K6kEq0Xy2DJR00BVuEejw/exec";

  const addButton = document.getElementById("addInflowBtn");

  addButton.addEventListener("click", async () => {
    const date = document.getElementById("date").value;
    const description = document.getElementById("description").value;
    const amount = document.getElementById("amount").value;
    const account = document.getElementById("account").value;


    if (!date || !amount) {
      alert("Please enter at least a date and amount.");
      return;
    }

    addButton.disabled = true;
    addButton.textContent = "Adding...";

    try {
      const response = await fetch(scriptURL, {
        method: "POST",
            body: JSON.stringify({
            type: "inflow",
            date,
            description,
            account,
            amount
            })
      });

      const result = await response.json();

      if (result.status === "success") {
        document.getElementById("description").value = "";
        document.getElementById("amount").value = "";

        const toast = document.getElementById("toast");
        toast.classList.add("show");
        setTimeout(() => toast.classList.remove("show"), 2000);

        if (navigator.vibrate) navigator.vibrate(40);

      } else {
        alert("Error: " + result.message);
      }

    } catch (err) {
      alert("Network error. Try again.");
    }

    addButton.disabled = false;
    addButton.textContent = "Add Inflow";
  });
</script>

<div id="toast">Inflow added âœ…</div>

<nav class="bottom-nav">
    <div class="bottom-nav-inner">
        <a href="index.html" class="nav-btn">Expense</a>
        <span class="nav-btn active">Inflow</span>
        <a href="transfer.html" class="nav-btn">Transfer</a>
    </div>
</nav>


</body>
</html>
