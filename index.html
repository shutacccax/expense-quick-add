<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Quick Add Expense</title>
  <link rel="stylesheet" href="styles.css">
  <link rel="manifest" href="manifest.json" />

  <link rel="apple-touch-icon" href="icon-180.png">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="default">

</head>


<body>

  <div class="container">
    <div class="card">

      <h1>âž• Add Expense</h1>
      <div id="balances" class="balances"></div>

      <button id="themeToggle" type="button" aria-label="Toggle dark mode">
        ðŸŒ™
      </button>


      <label for="date">Date</label>
      <input type="date" id="date" />

      <label for="description">Description</label>
      <input type="text" id="description" placeholder="Optional" />

      <label for="category">Category</label>
      <select id="category">
        <option>Food</option>
        <option>Transpo</option>
        <option>Bills</option>
        <option>Personal</option>
        <option>Shopping</option>
        <option>Entertainment</option>
        <option>Others</option>
      </select>

      <label for="payment">Payment</label>
      <select id="payment">
        <option>Cash</option>
        <option>GCash</option>
        <option>MariBank</option>
        <option>Maya</option>
      </select>

      <label for="amount">Amount</label>
      <input type="number" id="amount" placeholder="0.00" inputmode="decimal" />

      <button id="addExpenseBtn" type="button">
        Add Expense
      </button>


    </div>
  </div>



  <script>
    
  document.getElementById("date").valueAsDate = new Date();

  document.getElementById("amount").addEventListener("keydown", e => {
    if (e.key === "Enter") addButton.click();
  });


  const body = document.body;
  const themeToggle = document.getElementById("themeToggle");

  // Load saved theme
  if (localStorage.getItem("theme") === "dark") {
    body.classList.add("dark");
    themeToggle.textContent = "â˜€ï¸";
  } else {
    themeToggle.textContent = "ðŸŒ™";
  }

  themeToggle.addEventListener("click", () => {
    body.classList.toggle("dark");
    const isDark = body.classList.contains("dark");

    localStorage.setItem("theme", isDark ? "dark" : "light");
    themeToggle.textContent = isDark ? "â˜€ï¸" : "ðŸŒ™";
  });

  
  const scriptURL = "https://script.google.com/macros/s/AKfycbx0j7hBNOI9P_zceaZeLrkypGOXP5s7Emk0GqOfUiNns1K6kEq0Xy2DJR00BVuEejw/exec";

  const addButton = document.getElementById("addExpenseBtn");

  async function loadBalances() {
  try {
    const res = await fetch(scriptURL);
    const data = await res.json();

    if (data.status !== "success") return;

    const container = document.getElementById("balances");
    container.innerHTML = "";

    data.balances.forEach(item => {
      const card = document.createElement("div");
      card.className = "balance-card";

      card.innerHTML = `
        <div class="balance-account">${item.account}</div>
        <div class="balance-amount">â‚±${Number(item.balance).toLocaleString()}</div>
      `;

      container.appendChild(card);
    });

  } catch (err) {
    console.warn("Failed to load balances");
  }
}

  addButton.addEventListener("click", async () => {
    const date = document.getElementById("date").value;
    const description = document.getElementById("description").value;
    const category = document.getElementById("category").value;
    const payment = document.getElementById("payment").value;
    const amount = document.getElementById("amount").value;

    if (!date || !amount) {
      alert("Please enter at least a date and amount.");
      return;
    }

    addButton.disabled = true;
    addButton.textContent = "Adding...";

    try {
      const response = await fetch(scriptURL, {
        method: "POST",
        body: JSON.stringify({
          date,
          description,
          category,
          payment,
          amount
        })
      });

      const result = await response.json();

      if (result.status === "success") {
        document.getElementById("description").value = "";
        document.getElementById("amount").value = "";

        loadBalances();

        const toast = document.getElementById("toast");
        toast.classList.add("show");
        setTimeout(() => toast.classList.remove("show"), 2000);

        if (navigator.vibrate) navigator.vibrate(40);

      } else {
        alert("Error: " + result.message);
      }

    } catch (err) {
      alert("Network error. Try again.");
    }

    addButton.disabled = false;
    addButton.textContent = "Add Expense";
  });

  loadBalances();

</script>

<div id="toast">Expense added âœ…</div>


<nav class="bottom-nav">
  <span class="nav-btn active">Expense</span>
  <a href="inflow.html" class="nav-btn">Inflow</a>
  <a href="transfer.html" class="nav-btn">Transfer</a>
</nav>


</body>
</html>
